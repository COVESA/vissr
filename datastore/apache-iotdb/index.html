<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.103.1" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/vissr/images/fav.png" type="image/x-icon" />

    <title>WAII Apache IoTDB :: COVESA VISSv2 Reference Implementation (vissr)</title>

    
    <link href="/vissr/css/nucleus.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/fontawesome-all.min.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/hybrid.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/featherlight.min.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/perfect-scrollbar.min.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/auto-complete.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/atom-one-dark-reasonable.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/theme.css?1712578058" rel="stylesheet">
    <link href="/vissr/css/hugo-theme.css?1712578058" rel="stylesheet">
    
    <link href="/vissr/css/theme-blue.css?1712578058" rel="stylesheet">
    
    

    <script src="/vissr/js/jquery-3.3.1.min.js?1712578058"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/vissr/datastore/apache-iotdb/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://covesa.github.io/vissr/">
  <img src="/vissr/images/vissv2.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/vissr/js/lunr.min.js?1712578058"></script>
<script type="text/javascript" src="/vissr/js/auto-complete.js?1712578058"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/covesa.github.io\/vissr\/";
    
</script>
<script type="text/javascript" src="/vissr/js/search.js?1712578058"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vissr/build-system/" title="VISSR Build System" class="dd-item
        
        
        
        ">
      <a href="/vissr/build-system/">
          VISSR Build System
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/datastore/" title="VISSR Data Storage" class="dd-item
        parent
        
        
        ">
      <a href="/vissr/datastore/">
          VISSR Data Storage
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/vissr/datastore/memcached/" title="VISSR Memcached" class="dd-item
        
        
        
        ">
      <a href="/vissr/datastore/memcached/">
          VISSR Memcached
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vissr/datastore/redis/" title="VISSR Redis" class="dd-item
        
        
        
        ">
      <a href="/vissr/datastore/redis/">
          VISSR Redis
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vissr/datastore/sqlite/" title="VISSR SQLite" class="dd-item
        
        
        
        ">
      <a href="/vissr/datastore/sqlite/">
          VISSR SQLite
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vissr/datastore/apache-iotdb/" title="WAII Apache IoTDB" class="dd-item
        
        active
        
        ">
      <a href="/vissr/datastore/apache-iotdb/">
          WAII Apache IoTDB
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/feeder/" title="VISSR Feeders" class="dd-item
        
        
        
        ">
      <a href="/vissr/feeder/">
          VISSR Feeders
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/pocs/" title="VISSR POCs" class="dd-item
        
        
        
        ">
      <a href="/vissr/pocs/">
          VISSR POCs
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/vissr/pocs/poc2/" title="Next POC..." class="dd-item
        
        
        
        ">
      <a href="/vissr/pocs/poc2/">
          Next POC...
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vissr/pocs/poc1/" title="Vehicle.Speed subscription example" class="dd-item
        
        
        
        ">
      <a href="/vissr/pocs/poc1/">
          Vehicle.Speed subscription example
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/tools/" title="VISSR Tools" class="dd-item
        
        
        
        ">
      <a href="/vissr/tools/">
          VISSR Tools
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/client/" title="VISSv2 Clients" class="dd-item
        
        
        
        ">
      <a href="/vissr/client/">
          VISSv2 Clients
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/docker-step-by-step/" title="VISSv2 Docker" class="dd-item
        
        
        
        ">
      <a href="/vissr/docker-step-by-step/">
          VISSv2 Docker
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/peripheral-components/" title="VISSv2 peripheral components" class="dd-item
        
        
        
        ">
      <a href="/vissr/peripheral-components/">
          VISSv2 peripheral components
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vissr/server/" title="VISSv2 Server" class="dd-item
        
        
        
        ">
      <a href="/vissr/server/">
          VISSv2 Server
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/vissr/server/access-control-servers/" title="VISSv2 Access Control Servers" class="dd-item
        
        
        
        ">
      <a href="/vissr/server/access-control-servers/">
          VISSv2 Access Control Servers
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/covesa/vissr"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/covesa/vissr/edit/master/tutorial/content/datastore/apache-iotdb/_index.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vissr/'>COVESA Vehicle Information Service Specification ver 2 Reference Implementation Tutorial</a> > <a href='/vissr/datastore/'>VISSR Data Storage</a> > WAII Apache IoTDB
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#scope">Scope</a></li>
    <li><a href="#runtime-notes">Runtime notes</a>
      <ul>
        <li><a href="#assumptions">Assumptions</a></li>
        <li><a href="#database-schema">Database schema</a></li>
        <li><a href="#configuration">Configuration</a></li>
        <li><a href="#logging">Logging</a></li>
      </ul>
    </li>
    <li><a href="#quick-start-notes">Quick start notes</a>
      <ul>
        <li><a href="#apache-iotdb-images">Apache IoTDB images</a></li>
        <li><a href="#seeding-the-database-with-vss-data">Seeding the database with VSS data</a></li>
      </ul>
    </li>
    <li><a href="#development-notes">Development notes</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              WAII Apache IoTDB
            </h1>
          

        



	<h2 id="introduction">Introduction</h2>
<p>Description of Apache IoTDB from <a href="https://iotdb.apache.org/">https://iotdb.apache.org/</a>:</p>
<p><em>&ldquo;Apache IoTDB (Database for Internet of Things) is an IoT native database with high performance for data management and analysis, deployable on the edge and the cloud. Due to its light-weight architecture, high performance and rich feature set together with its deep integration with Apache Hadoop, Spark and Flink, Apache IoTDB can meet the requirements of massive data storage, high-speed data ingestion and complex data analysis in the IoT industrial fields.&rdquo;</em></p>
<h2 id="scope">Scope</h2>
<p>Support for Apache IoTDB as the WAII data store is implemented by connector code in the WAII service manager, which connects WAII to an external Apache IoTDB server. This code uses the IoTDB Go client to maintain a connection session to the IoTDB server, which is then used to get/set vehicle data from the database.</p>
<p>As WAII and the IoTDB server are separate processes WAII needs to be told where to find the IoTDB server and which storage prefix to use to access the data. The administration of the Apache IoTDB server itself, including startup and shutdown, is out of scope and is handled externally to WAII.</p>
<h2 id="runtime-notes">Runtime notes</h2>
<h3 id="assumptions">Assumptions</h3>
<p>Runtime assumptions:</p>
<ol>
<li>IoTDB server lifecycle (e.g. startup and shutdown) is handled externally to WAII</li>
<li>Management (e.g. creation/deletion) of the IoTDB timeseries containing VSS data is handled externally to WAII.</li>
<li>Configuration of the connector code is specified in the config file iotdb-config.json. If the config file is not found then build-time defaults are used.</li>
</ol>
<p>Handling of IoTDB server and timeseries management is placed outside of WAII to allow flexible deployment through loosely coupled connections.</p>
<h3 id="database-schema">Database schema</h3>
<p>The connector assumes a simple key/value pair schema for accessing VSS data in an IoTDB timeseries:</p>
<ol>
<li>
<p>VSS node names (keys) are backtick quoted when stored as measurement keys in the database e.g. <code>`Vehicle.CurrentLocation.Longitude`</code>. This avoids IoTDB interpreting the VSS tree path, here <code>Vehicle.CurrentLocation.</code>, as part of its storage path which also uses a dot notation.</p>
</li>
<li>
<p>VSS data is stored using native (IoTDB) data types rather than strings.</p>
</li>
<li>
<p>That the timeseries containing VSS nodes can be found using the prefix path specified in the config file.</p>
</li>
</ol>
<p>Example timeseries:</p>
<pre tabindex="0"><code>+------------------------+-----------------------------------------------------+--------+--------+
|                    Time|                                           Timeseries|   Value|DataType|
+------------------------+-----------------------------------------------------+--------+--------+
|2024-03-07T17:55:24.514Z|  root.test2.dev1.`Vehicle.CurrentLocation.Longitude`|-42.4567|   FLOAT|
+------------------------+-----------------------------------------------------+--------+--------+
</code></pre><h3 id="configuration">Configuration</h3>
<p>The connection code reads its runtime configuration from the JSON formatted file <code>iotdb-config.json</code> located in the vissv2server directory. All values should be specified.</p>
<h4 id="configuration-file-format">Configuration file format</h4>
<table>
<thead>
<tr>
<th>Key name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td>String</td>
<td>Hostname or IP address of the IoTDB server</td>
</tr>
<tr>
<td><code>port</code></td>
<td>String</td>
<td>RPC port of the server. Default is 6667</td>
</tr>
<tr>
<td><code>username</code></td>
<td>String</td>
<td>Username to access the server. Default is root</td>
</tr>
<tr>
<td><code>password</code></td>
<td>String</td>
<td>Password to access the server. Default is root</td>
</tr>
<tr>
<td><code>queryPrefixPath</code></td>
<td>String</td>
<td>Timeseries prefix path of VSS data in the database</td>
</tr>
<tr>
<td><code>queryTimeout(ms)</code></td>
<td>Int</td>
<td>Query timeout in milliseconds</td>
</tr>
</tbody>
</table>
<p>Example <code>iotdb-config.json</code>:</p>
<pre tabindex="0"><code>{
	&#34;host&#34;: &#34;127.0.0.1&#34;,
	&#34;port&#34;: &#34;6667&#34;,
	&#34;username&#34;: &#34;root&#34;,
	&#34;password&#34;: &#34;root&#34;,
	&#34;queryPrefixPath&#34;: &#34;root.test2.dev1&#34;,
	&#34;queryTimeout(ms)&#34;: 5000
}
</code></pre><h3 id="logging">Logging</h3>
<p>The connector writes information, warning and error messages to the WAII server log with the prefix <code>IoTDB</code>. Grepping in the log for that prefix string can help you quickly identify connector messages.</p>
<h2 id="quick-start-notes">Quick start notes</h2>
<p>The following notes are intended to help you quickly try out using Apache IoTDB as a data store.</p>
<p>The Apache IoTDB project <a href="https://iotdb.apache.org/">website</a> has extensive documentation on the IoTDB server.</p>
<h3 id="apache-iotdb-images">Apache IoTDB images</h3>
<p>The Apache IoTDB community maintains pre-built server images upstream to <a href="https://iotdb.apache.org/Download/">download</a>. Including containerised Docker images in <a href="https://hub.docker.com/r/apache/iotdb">Docker Hub</a>. IoTDB is available in both standalone (edge) and cluster (cloud) versions. Standalone is suggested as a starting point.</p>
<p>The <a href="https://github.com/COVESA/cdsp">COVESA Central Data Service Playground</a> provides a Docker deployment that combines an Apache IoTDB server (data store) with the WAII VISS data server.</p>
<h3 id="seeding-the-database-with-vss-data">Seeding the database with VSS data</h3>
<p>To seed the database with VSS data the typical steps are:</p>
<ol>
<li>Create the database in the server</li>
<li>Create a timeseries in the database populated with the VSS nodes (keys) you are interested in.</li>
<li>Add some example data so the VISS Data Server can successfully get data.</li>
</ol>
<p>IoTDB has a very extensive collection of integrations, tools, clients and APIs that could be used to achieve this.</p>
<h4 id="example-using-iotdb-cli-client">Example using IoTDB CLI client</h4>
<p>The following tutorial shows an example using the <a href="https://iotdb.apache.org/UserGuide/latest/Tools-System/CLI.html">IoTDB CLI client</a>, using two methods. Firstly, in interactive mode where you type the commands and then sending the same commands in batch command mode.</p>
<ol>
<li>Connect to the CLI client from your host:</li>
</ol>
<pre tabindex="0"><code>$ bash &lt;iotdb path&gt;/sbin/start-cli.sh -h &lt;server hostname/ip&gt;
</code></pre><ol start="2">
<li>Create database from CLI command line:</li>
</ol>
<pre tabindex="0"><code>IoTDB &gt; create database root.test2.dev1
</code></pre><ol start="3">
<li>Create timeseries from CLI command line:</li>
</ol>
<pre tabindex="0"><code>IoTDB &gt; CREATE ALIGNED TIMESERIES root.test2.dev1(`Vehicle.CurrentLocation.Longitude` FLOAT, `Vehicle.CurrentLocation.Latitude` FLOAT, `Vehicle.Cabin.Infotainment.HMI.DistanceUnit` TEXT)
</code></pre><p>4 Add some data into the timeseries:</p>
<pre tabindex="0"><code>IoTDB&gt; insert into root.test2.dev1(`Vehicle.CurrentLocation.Longitude`, `Vehicle.CurrentLocation.Latitude`, `Vehicle.Cabin.Infotainment.HMI.DistanceUnit`) values(-42.4567, 22.1234, &#39;MILES&#39;)
</code></pre><ol start="5">
<li>Display the data just added as a sanity check:</li>
</ol>
<pre tabindex="0"><code>IoTDB&gt; select last * from root.test2.dev1
+------------------------+-------------------------------------------------------------+--------+--------+
|                    Time|                                                   Timeseries|   Value|DataType|
+------------------------+-------------------------------------------------------------+--------+--------+
|2024-03-07T17:55:24.514Z|          root.test2.dev1.`Vehicle.CurrentLocation.Longitude`|-42.4567|   FLOAT|
|2024-03-07T17:55:24.514Z|root.test2.dev1.`Vehicle.Cabin.Infotainment.HMI.DistanceUnit`|   MILES|    TEXT|
|2024-03-07T17:55:24.514Z|           root.test2.dev1.`Vehicle.CurrentLocation.Latitude`| 22.1234|   FLOAT|
+------------------------+-------------------------------------------------------------+--------+--------+
</code></pre><p>You have now seeded the database with some initial VSS data and can use WAII to query it.</p>
<p>The CLI client startup script accepts SQL commands using the <code>-e</code> parameter. We can therefore use this to codify the above in a bash script. So the VSS node names (keys) are passed correctly on the command line the backticks must be escaped.</p>
<p>For example:</p>
<pre tabindex="0"><code># !/bin/bash

host=127.0.0.1
rpcPort=6667
user=root
pass=root

bash ./sbin/start-cli.sh -h ${host} -p ${rpcPort} -u ${user} -pw ${pass} -e &#34;create database root.test2.dev1&#34;
bash ./sbin/start-cli.sh -h ${host} -p ${rpcPort} -u ${user} -pw ${pass} -e &#34;CREATE ALIGNED TIMESERIES root.test2.dev1(\`Vehicle.CurrentLocation.Longitude\` FLOAT, \`Vehicle.CurrentLocation.Latitude\` FLOAT, \`Vehicle.Cabin.Infotainment.HMI.DistanceUnit\` TEXT)&#34;
bash ./sbin/start-cli.sh -h ${host} -p ${rpcPort} -u ${user} -pw ${pass} -e &#34;insert into root.test2.dev1(\`Vehicle.CurrentLocation.Longitude\`, \`Vehicle.CurrentLocation.Latitude\`, \`Vehicle.Cabin.Infotainment.HMI.DistanceUnit\`) values(-42.4567, 22.1234, &#39;MILES&#39;)&#34;
bash ./sbin/start-cli.sh -h ${host} -p ${rpcPort} -u ${user} -pw ${pass} -e &#34;select last * from root.test2.dev1&#34;
</code></pre><p>Of course any of the programming language clients provided by IoTDB, e.g. go, python, C++, Rust, can also be used to achieve the same result.</p>
<h2 id="development-notes">Development notes</h2>
<p>Please see the notes in the source commit messages and related Github pull requests for the history of the development of the Apache IoTDB connection code and its integration into the WAII Service Manager component.</p>
<p>Development followed the patterns set by the existing support for Redis and SQLite.</p>
<p>The connection code was first developed with Apache IoTDB v1.2.2, using the upstream standalone pre-built image and Apache IoTDB Go Client v1.1.7.</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/vissr/datastore/sqlite/" title="VISSR SQLite"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vissr/feeder/" title="VISSR Feeders" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/vissr/js/clipboard.min.js?1712578058"></script>
    <script src="/vissr/js/perfect-scrollbar.min.js?1712578058"></script>
    <script src="/vissr/js/perfect-scrollbar.jquery.min.js?1712578058"></script>
    <script src="/vissr/js/jquery.sticky.js?1712578058"></script>
    <script src="/vissr/js/featherlight.min.js?1712578058"></script>
    <script src="/vissr/js/highlight.pack.js?1712578058"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/vissr/js/modernizr.custom-3.6.0.js?1712578058"></script>
    <script src="/vissr/js/learn.js?1712578058"></script>
    <script src="/vissr/js/hugo-learn.js?1712578058"></script>
    
        
            <script src="/vissr/mermaid/mermaid.js?1712578058"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
